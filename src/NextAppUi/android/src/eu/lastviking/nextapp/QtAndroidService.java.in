package @PACKAGE_NAME@;

import @PACKAGE_NAME@.R;
import android.app.Notification;
import android.app.NotificationChannel;
import android.app.NotificationManager;
import android.content.Intent;
import android.os.Build;
import org.qtproject.qt.android.bindings.QtService;
import android.content.Context;

public class QtAndroidService extends QtService {
    private static final String CHANNEL_ID = "NextAppServiceChannel";

    @Override
    public int onStartCommand(Intent intent, int flags, int startId) {
        createNotificationChannel();
        Notification notification =
            (Build.VERSION.SDK_INT >= Build.VERSION_CODES.O
                ? new Notification.Builder(this, CHANNEL_ID)
                : new Notification.Builder(this))
            .setContentTitle("NextApp Running")
            .setContentText("NextApp is active in the background")
            .setSmallIcon(R.drawable.icon)  // make sure this resource exists
            .build();

        startForeground(1, notification);
        return super.onStartCommand(intent, flags, startId);
    }

    private void createNotificationChannel() {
        if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.O) {
            NotificationChannel chan = new NotificationChannel(
                CHANNEL_ID,
                "NextApp Background Service",
                NotificationManager.IMPORTANCE_LOW);
            NotificationManager mgr = getSystemService(NotificationManager.class);
            mgr.createNotificationChannel(chan);
        }
    }

    public static void startQtAndroidService(Context ctx) {
        Intent i = new Intent(ctx, QtAndroidService.class);
        if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.O) {
            ctx.startForegroundService(i);
        } else {
            ctx.startService(i);
        }
    }
}
